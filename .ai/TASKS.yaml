# Task DAG (SSOT)
# status: queued | running | blocked | review | done
#
# owner_role の選択肢:
#   - org-planner      : 要件整理（Claude subagent）
#   - org-architect    : 設計・Contract定義（Claude subagent）
#   - codex-implementer: 実装（Codex worker）★推奨
#   - codex-reviewer   : レビュー（Codex worker）★推奨
#   - org-integrator   : 統合・マージ（Claude subagent）
#   - org-scribe       : 台帳整理（Claude subagent）
#
# ※ org-implementer / org-reviewer は非推奨（Codex に移行済み）

tasks:
  - id: T-001
    title: "Kickoff: collect requirements"
    status: queued
    deps: []
    owner_role: "org-planner"
    allowed_paths: [".ai/"]
    acceptance:
      - "PROJECT.md populated"
      - "DECISIONS.md has pending list"
    notes: ""

  - id: T-002
    title: "Design: define contracts (API/schema)"
    status: queued
    deps: ["T-001"]
    owner_role: "org-architect"
    allowed_paths: ["docs/", "src/"]
    acceptance:
      - "contracts documented"
    notes: ""

  # === OrgOS 改善タスク ===

  - id: T-OS-001
    title: "セッション間メモリ永続化（Stop フック + sessions フォルダ）"
    status: done
    deps: []
    owner_role: "org-implementer"
    allowed_paths: [".claude/hooks/", ".ai/sessions/", ".ai/LEARNED/"]
    acceptance:
      - "Stop フックがセッション学習を抽出・保存"
      - ".ai/sessions/ に日次ログが生成される"
      - "SessionStart で前回の学びをロード"
    notes: "記事参照: PreCompact + Stop + SessionStart パターン"

  - id: T-OS-002
    title: "継続学習スキル（/org-learn コマンド）"
    status: done
    deps: ["T-OS-001"]
    owner_role: "org-implementer"
    allowed_paths: [".claude/commands/", ".claude/skills/learned/"]
    acceptance:
      - "/org-learn コマンドが動作する"
      - "パターンが .claude/skills/learned/ に保存される"
      - "次回セッションで自動参照される"
    notes: "記事参照: Continuous Learning Skill"

  - id: T-OS-003
    title: "評価ループ（CONTROL.yaml 拡張 + 評価ポリシー）"
    status: done
    deps: []
    owner_role: "org-implementer"
    allowed_paths: [".ai/CONTROL.yaml", ".claude/rules/", "CLAUDE.md"]
    acceptance:
      - "CONTROL.yaml に eval_policy セクション追加"
      - "チェックポイント評価が /org-tick で動作"
      - "評価結果が DECISIONS.md に記録される"
    notes: "記事参照: Verification Loops and Evals"

  - id: T-OS-004
    title: "上司レビューモード（スーパーバイザーレビュー機能）"
    status: queued
    deps: []
    owner_role: "codex-implementer"
    allowed_paths: [".ai/", ".claude/commands/", ".claude/rules/", "CLAUDE.md"]
    acceptance:
      - "/org-start で「作業者」「上司レビュー要否」を質問"
      - "CONTROL.yaml に supervisor_review セクション追加"
      - "重要な判断時にレビュードキュメント自動生成（.ai/SUPERVISOR_REVIEW/）"
      - "計画乖離を自動検知（BRIEF.md とのずれ）"
      - "レビュー承認待ち状態で停止する仕組み"
    notes: |
      3つのモード:
      1. 自分 + レビューあり（重要な判断で上司レビューをリマインド）
      2. 自分のみ（上司レビューなし）
      3. 部下 + スーパーバイザー（部下が作業、上司レビュー必須）

  - id: T-OS-005
    title: "プロジェクト引き継ぎ機能"
    status: queued
    deps: ["T-OS-004"]
    owner_role: "codex-implementer"
    allowed_paths: [".ai/", ".claude/commands/", ".claude/hooks/", "CLAUDE.md"]
    acceptance:
      - "CONTROL.yaml に handoff セクション追加"
      - "引き継ぎドキュメント（.ai/HANDOFF.md）自動生成"
      - "SessionStart フックで引き継ぎ検知"
      - "引き継ぎ時の注意事項を表示"
    notes: |
      引き継ぎパターン:
      - 上司が BRIEF → 要件定義 → git push
      - 部下が git pull → /org-tick で続きから作業
      - 引き継ぎ情報（誰から誰へ、どこまで完了、注意事項）を記録

  # === 以下はCodex workerを使う実装タスクの例 ===
  # - id: T-003
  #   title: "Implement: user authentication module"
  #   status: queued
  #   deps: ["T-002"]
  #   owner_role: "codex-implementer"  # ← Codex worker
  #   allowed_paths: ["src/auth/", "tests/auth/"]
  #   acceptance:
  #     - "login/logout implemented"
  #     - "tests pass"
  #   notes: ""
