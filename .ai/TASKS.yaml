# Task DAG (SSOT)
# status: queued | running | blocked | review | done
#
# owner_role の選択肢:
#   - org-planner      : 要件整理（Claude subagent）
#   - org-architect    : 設計・Contract定義（Claude subagent）
#   - codex-implementer: 実装（Codex worker）★推奨
#   - codex-reviewer   : レビュー（Codex worker）★推奨
#   - org-integrator   : 統合・マージ（Claude subagent）
#   - org-scribe       : 台帳整理（Claude subagent）
#
# ※ org-implementer / org-reviewer は非推奨（Codex に移行済み）

tasks:
  - id: T-001
    title: "Kickoff: collect requirements"
    status: queued
    deps: []
    owner_role: "org-planner"
    allowed_paths: [".ai/"]
    acceptance:
      - "PROJECT.md populated"
      - "DECISIONS.md has pending list"
    notes: ""

  - id: T-002
    title: "Design: define contracts (API/schema)"
    status: queued
    deps: ["T-001"]
    owner_role: "org-architect"
    allowed_paths: ["docs/", "src/"]
    acceptance:
      - "contracts documented"
    notes: ""

  # === OrgOS 改善タスク ===

  - id: T-OS-001
    title: "セッション間メモリ永続化（Stop フック + sessions フォルダ）"
    status: done
    deps: []
    owner_role: "org-implementer"
    allowed_paths: [".claude/hooks/", ".ai/sessions/", ".ai/LEARNED/"]
    acceptance:
      - "Stop フックがセッション学習を抽出・保存"
      - ".ai/sessions/ に日次ログが生成される"
      - "SessionStart で前回の学びをロード"
    notes: "記事参照: PreCompact + Stop + SessionStart パターン"

  - id: T-OS-002
    title: "継続学習スキル（/org-learn コマンド）"
    status: done
    deps: ["T-OS-001"]
    owner_role: "org-implementer"
    allowed_paths: [".claude/commands/", ".claude/skills/learned/"]
    acceptance:
      - "/org-learn コマンドが動作する"
      - "パターンが .claude/skills/learned/ に保存される"
      - "次回セッションで自動参照される"
    notes: "記事参照: Continuous Learning Skill"

  - id: T-OS-003
    title: "評価ループ（CONTROL.yaml 拡張 + 評価ポリシー）"
    status: done
    deps: []
    owner_role: "org-implementer"
    allowed_paths: [".ai/CONTROL.yaml", ".claude/rules/", "CLAUDE.md"]
    acceptance:
      - "CONTROL.yaml に eval_policy セクション追加"
      - "チェックポイント評価が /org-tick で動作"
      - "評価結果が DECISIONS.md に記録される"
    notes: "記事参照: Verification Loops and Evals"

  - id: T-OS-004
    title: "上司レビューモード（スーパーバイザーレビュー機能）"
    status: done
    deps: []
    owner_role: "codex-implementer"
    allowed_paths: [".ai/", ".claude/commands/", ".claude/rules/", "CLAUDE.md"]
    acceptance:
      - "/org-start で「作業者」「上司レビュー要否」を質問"
      - "CONTROL.yaml に supervisor_review セクション追加"
      - "重要な判断時にレビュードキュメント自動生成（.ai/SUPERVISOR_REVIEW/）"
      - "計画乖離を自動検知（BRIEF.md とのずれ）"
      - "レビュー承認待ち状態で停止する仕組み"
    notes: |
      3つのモード:
      1. 自分 + レビューあり（重要な判断で上司レビューをリマインド）
      2. 自分のみ（上司レビューなし）
      3. 部下 + スーパーバイザー（部下が作業、上司レビュー必須）

  - id: T-OS-005
    title: "プロジェクト引き継ぎ機能"
    status: done
    deps: ["T-OS-004"]
    owner_role: "codex-implementer"
    allowed_paths: [".ai/", ".claude/commands/", ".claude/hooks/", "CLAUDE.md"]
    acceptance:
      - "CONTROL.yaml に handoff セクション追加"
      - "引き継ぎドキュメント（.ai/HANDOFF.md）自動生成"
      - "SessionStart フックで引き継ぎ検知"
      - "引き継ぎ時の注意事項を表示"
    notes: |
      引き継ぎパターン:
      - 上司が BRIEF → 要件定義 → git push
      - 部下が git pull → /org-tick で続きから作業
      - 引き継ぎ情報（誰から誰へ、どこまで完了、注意事項）を記録

  - id: T-OS-006
    title: "ゴール階層管理・動的計画再構築機能"
    status: done
    deps: []
    owner_role: "codex-implementer"
    allowed_paths: [".ai/", ".claude/commands/", ".claude/rules/", "CLAUDE.md"]
    acceptance:
      - ".ai/GOALS.yaml 新規作成（Vision/Milestone/Project 階層管理）"
      - "/org-start で GOALS.yaml 自動生成（BRIEF.md から Vision 抽出）"
      - "/org-tick で Milestone 達成確認・見直し提案"
      - "/org-goals コマンド作成（ゴール可視化・編集）"
      - "DASHBOARD.md に Vision/Milestone 表示"
      - "新規依頼の位置づけ自動判断（Vision/Milestone/Project/Task）"
      - "GOALS.yaml history にゴール変更履歴を記録"
    notes: |
      OIP-006 参照。
      ユーザーの依頼に応じてゴールを再構造化し、全体整合のある計画を維持。
      Vision → Milestone → Project → Task の4階層で管理。
      Milestone 達成時・新規依頼が乖離時・20タスク完了ごとに見直し提案。

  - id: T-OS-007
    title: "成果物管理機能（outputs/ フォルダ構造 + 資料複製ルール）"
    status: done
    deps: []
    owner_role: "codex-implementer"
    allowed_paths: ["outputs/", ".gitignore", "CLAUDE.md", ".claude/agents/AGENTS.md", ".claude/rules/"]
    acceptance:
      - "outputs/ フォルダ構造の設計・実装（日付別 + タスクID別）"
      - ".gitignore に outputs/ の扱いを追加"
      - "CLAUDE.md に成果物管理ルールを追加"
      - "AGENTS.md（Codex worker）に資料複製→outputs/ 配置のフローを追加"
      - "outputs/README.md 作成（フォルダ説明）"
    notes: |
      Owner依頼: 成果物を資料（samplecode など）から分離して outputs/ に格納。
      資料は直接編集せず、複製して outputs/ に配置。

      構造例:
      outputs/
      ├── 2026-01-23/       # 日付別
      │   ├── sample1.ts
      │   └── README.md
      └── T-OS-004/         # タスクID別
          └── implementation.ts

      .gitignore: outputs/ を管理対象にするか Owner に確認（デフォルト: 管理する）

  # === 以下はCodex workerを使う実装タスクの例 ===
  # - id: T-003
  #   title: "Implement: user authentication module"
  #   status: queued
  #   deps: ["T-002"]
  #   owner_role: "codex-implementer"  # ← Codex worker
  #   allowed_paths: ["src/auth/", "tests/auth/"]
  #   acceptance:
  #     - "login/logout implemented"
  #     - "tests pass"
  #   notes: ""
