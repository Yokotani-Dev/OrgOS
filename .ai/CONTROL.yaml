# OrgOS Control Plane (SSOT)
# /org-start 実行時にこのファイルは初期化される
# Managerはこのファイルを読み、必要に応じて更新する（Owner承認が必要な項目は勝手に変えない）

# プロジェクト名（/org-start で BRIEF.md から設定）
project_name: "<SET_ME>"

# プロジェクトスコープ（このリポジトリで受け付ける作業の範囲）
# OrgOS 開発ディレクトリでは "OrgOS development only" に設定
# 一般プロジェクトでは BRIEF.md のスコープに設定
project_scope: "OrgOS development only"

# ステージ
# KICKOFF -> REQUIREMENTS -> DESIGN -> IMPLEMENTATION -> INTEGRATION -> RELEASE
stage: KICKOFF

# 制御フラグ
autopilot: false      # true: 自動進行（stop_gate.py で制御）
paused: false         # true: 一時停止
awaiting_owner: false # true: Owner の回答待ち

# Owner承認が必要な危険フラグ
# デフォルトfalse、Ownerがtrueに変更すると許可される
# 注意: フラグ行にはインラインコメントを入れないこと（パーサーが読めなくなる）
allow_push: true
allow_push_main: true
allow_main_mutation: true
allow_deploy: false
allow_destructive_ops: false
allow_os_mutation: true

# 保護対象ブランチ
main_branch: "main"

# OrgOS-Dev 開発モード（trueならOrgOS-Dev接続警告をスキップ）
is_orgos_dev: true

# Owner の IT リテラシーレベル（/org-start 時に設定）
# beginner: IT初心者向け（専門用語を避け、平易な日本語で説明）
# intermediate: 一般ユーザー向け（基本的なIT用語はOK）
# advanced: 開発者向け（専門用語をそのまま使用）
owner_literacy_level: "intermediate"

# ゲート状態（Managerが更新、Owner Reviewが必要なものは awaiting_owner で止める）
gates:
  kickoff_complete: false
  requirements_approved: false
  design_approved: false
  integration_approved: false
  release_approved: false

# Owner Review ポリシー
# /org-start または /org-settings で設定
owner_review_policy:
  # レビューモード
  # every_tick: タスク完了ごとにレビュー
  # every_n_tasks: Nタスクごとにレビュー（バランス型、デフォルト）
  # batch: 全タスク完了後にまとめてレビュー
  # manual: Ownerが明示的に依頼するまでレビューしない
  mode: "every_n_tasks"
  every_n_tasks: 3                # mode=every_n_tasks の場合のタスク数
  on_stage_transition: true       # ステージ遷移時は常にレビュー
  always_before_merge_to_main: true
  always_before_release: true
  tasks_since_last_review: 0      # カウンター（ランタイム）

# Codex worker 設定 (OpenAI Codex CLI)
codex:
  # true: Manager が codex exec を自動実行
  # false: Ownerが手動で codex exec を実行（デフォルト、推奨）
  auto_exec: false

  # sandbox ポリシー (-s, --sandbox)
  # read-only: 読み取りのみ（最も安全）
  # workspace-write: ワークスペース書き込み許可（推奨）
  # danger-full-access: フルアクセス（危険）
  sandbox: "workspace-write"

  # 承認ポリシー (-a, --ask-for-approval)
  # untrusted: 毎回確認（最も安全）
  # on-failure: 失敗時のみ確認
  # on-request: 要求時のみ確認（推奨）
  # never: 確認なし（CI環境のみ）
  approval: "on-request"

# 評価ポリシー（Verification Loops）
# 参照: 記事「Verification Loops and Evals」
eval_policy:
  # 評価モード
  # checkpoint: ステージ遷移時にチェックポイント評価
  # continuous: Nタスクごとに継続的評価
  # disabled: 評価なし
  mode: "checkpoint"

  # checkpoint モード設定
  checkpoint_stages:
    - design         # 設計完了時
    - implementation # 実装完了時
    - integration    # 統合完了時

  # continuous モード設定
  continuous_interval_tasks: 5  # Nタスクごとに評価

  # 評価基準
  criteria:
    # pass@k: k回中1回でも成功すればOK（探索的タスク向け）
    # pass^k: k回全て成功が必要（一貫性重視タスク向け）
    default_metric: "pass@1"

    # チェック項目
    checks:
      - "tests_pass"        # テストが通る
      - "build_success"     # ビルドが通る
      - "no_regressions"    # 既存機能が壊れていない

  # 評価結果の記録先
  record_to: "DECISIONS.md"

  # 最後の評価タイムスタンプ（ランタイム）
  last_eval_at: null
  tasks_since_last_eval: 0

# ランタイム設定
runtime:
  max_parallel_tasks: 6  # 同時実行タスク数上限
  tick_count: 0          # Tick カウンタ
