# /org-learn - 学習抽出コマンド

セッション中の作業から再利用可能なパターンを抽出し、`.ai/LEARNINGS/` に保存する。

---

## 実行タイミング

- 難しい問題を解決した後
- 予期せぬ挙動を発見した後
- 効果的なデバッグ手法を見つけた後
- プロジェクト固有のパターンを確立した後

---

## 実行手順

### Step 1: セッション振り返り

このセッションで行った作業を振り返り、以下に該当するものを探す：

| カテゴリ | 探すもの |
|----------|----------|
| エラー修正 | 根本原因の特定に時間がかかった問題、類似問題に適用可能な解決策 |
| デバッグ手法 | 効果的だったツールの組み合わせ、独自のアプローチ |
| ワークアラウンド | ライブラリの癖、API制約、バージョン固有の回避策 |
| プロジェクト規約 | このプロジェクト固有のパターン、アーキテクチャ上の決定 |

### Step 2: 抽出判断

以下の基準で記録すべきか判断：

**記録する:**
- 将来のセッションで時間節約になる
- 他の開発者にも役立つ
- ドキュメントに書かれていない知見

**記録しない:**
- 些細なtypo修正
- 一回限りの特殊な状況
- 公式ドキュメントに書いてあること

### Step 3: パターン文書化

抽出するパターンがあれば、以下のフォーマットで文書を作成：

```markdown
# <タイトル>

## 問題

<何が起きたか - 具体的な症状やエラーメッセージ>

## 原因

<なぜ起きたか - 根本原因の説明>

## 解決策

<どう解決したか - 具体的なコード例や手順>

## 適用条件

<いつこの知識を使うべきか - どんな状況で役立つか>

## 参照

- <関連ドキュメントやIssue>
```

### Step 4: ファイル保存

`.ai/LEARNINGS/YYYY-MM-DD-<slug>.md` に保存。

```
例: .ai/LEARNINGS/2026-01-21-supabase-rls-cache.md
```

### Step 5: 確認

Ownerに内容を確認してもらう（任意）。

---

## 出力例

```markdown
# Supabase RLSキャッシュの落とし穴

## 問題

RLSポリシーを更新したのに、古いルールが適用され続けた。
エラー: "permission denied for table users"

## 原因

Supabaseはパフォーマンス最適化のためRLSポリシーをキャッシュしている。
スキーマキャッシュをリフレッシュしないと、変更が反映されない。

## 解決策

Supabase ダッシュボードで「Reload Schema」を実行するか、
SQL エディタで以下を実行：

```sql
NOTIFY pgrst, 'reload schema';
```

## 適用条件

- RLSポリシーを変更したのに反映されない
- 権限エラーが出るが、ポリシーは正しく見える
- 開発環境で問題なく、本番で失敗する

## 参照

- https://supabase.com/docs/guides/database/postgres/row-level-security
- https://github.com/supabase/supabase/discussions/12345
```

---

## 記録しない例

以下は記録しない：

- 「import 文のtypoを修正した」
- 「npm install を実行した」
- 「公式ドキュメント通りに設定した」

---

## 蓄積した学習の活用

蓄積された `.ai/LEARNINGS/` は：

1. **Work Order に含める** - 関連するタスクの参照資料として
2. **オンボーディング** - 新規メンバーへの共有資料として
3. **振り返り** - 定期的なレトロスペクティブの材料として

---

## 参照

- `.ai/LEARNINGS/README.md` - ディレクトリの説明
- `/org-os-retro` - OrgOS自体の振り返り（改善提案）
