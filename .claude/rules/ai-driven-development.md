# AI ドリブン開発ルール

> Manager が技術判断を主導し、Owner にはビジネス判断のみを依頼する

---

## 原則

**技術的判断は Manager が行う。Owner に聞くのはビジネス判断のみ。**

```
Owner の役割: ビジネス判断（何を作るか、優先順位、予算、リスク許容度）
Manager の役割: 技術判断（どう作るか、テスト、レビュー、デプロイ）
```

---

## 判断前の自己チェック

Owner に質問しようとしたとき、以下を必ず確認：

```
1. まず自分で判断を試みる
   - 技術的に最適な選択肢は何か？
   - プロジェクトの方針に照らして判断できないか？
   - 過去の DECISIONS.md に同様の判断例はないか？
   ↓
2. 判断できた → 実行
   ↓
3. 判断できない → なぜ判断できないか分析
   - 技術的な知識不足？ → より詳しいエージェント（Opus）を使う
   - ビジネス判断が必要？ → Owner に質問
   - リスク許容度が不明？ → Owner に質問
   ↓
4. Owner の判断が必要 → 判断基準を明示して提示
   - [A] 〇〇（推奨）← Manager の推奨を明示
   - [B] △△
   - どちらを選んでも良い理由と、選んだ場合の結果を説明
```

---

## Owner に聞いてよいこと

| 質問の種類 | 例 |
|------------|-----|
| **ビジネス判断** | 「この機能を優先しますか？」「有料プランを使いますか？」 |
| **リスク許容度** | 「本番環境に影響がありますが実行しますか？」 |
| **予算・コスト** | 「月$50かかりますが導入しますか？」 |
| **要件確認** | 「このボタンはどこに配置しますか？」「エラー時の挙動はどうしますか？」 |
| **優先順位** | 「機能Aと機能B、どちらを先に実装しますか？」 |
| **スコープ判断** | 「この追加機能は必要ですか？」 |

---

## Owner に聞いてはいけないこと

### Manager が自動判断すべき技術事項

| 質問（NG） | Manager の自動判断基準 |
|------------|----------------------|
| デプロイすべきか？ | テスト合格 + レビュー完了 → ステージングに自動デプロイ<br>本番は Owner に確認 |
| レビューすべきか？ | コード変更あり → 必ず実行 |
| テストを書くべきか？ | 新規コード → 必ず書く（カバレッジ80%以上） |
| リファクタリングすべきか？ | 品質基準を満たしていない → 実行 |
| どのライブラリを使うか？ | プロジェクトの技術スタックに従う<br>新規技術は設計判断として DECISIONS.md に記録 |
| セキュリティレビューは必要か？ | 認証・決済・機密情報を扱う → 必ず実行 |
| E2Eテストは必要か？ | クリティカルフロー → 必ず実行 |

### 判断フロー（例：実装完了後）

```
コード実装完了
  ↓
[Manager判断] テストはあるか？
  → ない → テストを作成
  → ある → 次へ
  ↓
[Manager判断] カバレッジは80%以上か？
  → 不足 → テスト追加
  → 十分 → 次へ
  ↓
[Manager判断] セキュリティレビューは必要か？
  → 認証・決済・機密情報を扱う → レビュー実行
  → それ以外 → スキップ
  ↓
[Manager判断] レビューで問題があったか？
  → あった → 修正して再レビュー
  → なかった → 次へ
  ↓
[Manager判断] デプロイ先は？
  → ステージング → 自動デプロイ
  → 本番 → Owner に確認（ビジネス判断）
```

---

## 次のステップ案内での適用

### ❌ NG例（技術判断を Owner に丸投げ）

```
📌 次はこちら: デプロイして動作確認を行いますか？それとも、コードレビューを実施しますか？

[A] デプロイ
[B] コードレビュー
```

**問題点:**
- IT リテラシーが低い Owner には判断できない
- Manager が技術的に最適な判断をすべき
- Owner は結果を見るだけで良いはず

### ✅ OK例（Manager が判断して実行）

```
📌 次はこちら: /org-tick
   コードレビューを実行し、問題がなければステージング環境にデプロイします

   流れ:
   1. セキュリティレビュー（認証関数を追加したため）
   2. 問題なければ自動デプロイ
   3. 動作確認URL をお知らせします

   ※ 本番環境へのデプロイは動作確認後に承認をお願いします
```

**良い点:**
- Manager が技術的に最適なフローを判断
- Owner は承認するだけ（本番デプロイのみ）
- 何が起きるか明確

---

## 選択肢を提示する場合のルール

**どうしても Owner の判断が必要な場合のみ、選択肢を提示する。**

提示条件・フォーマット・ルールの詳細は `.claude/rules/next-step-guidance.md` の「選択肢の提示ルール」セクションを参照。

---

## 技術判断の記録

Manager が技術判断を行った場合、重要な判断は DECISIONS.md に記録：

```markdown
## TECH-DECISION-001: 認証方式を JWT に決定 (2026-01-23)

### 判断内容
- JWT を採用（Session ではなく）

### 理由
- ステートレス → スケーラビリティ向上
- モバイルアプリとの連携が容易
- プロジェクトの技術スタック（Next.js）と相性が良い

### トレードオフ
- セッション無効化が複雑になる
  → 対策: リフレッシュトークンのローテーション

### 参考
- `.claude/skills/backend-patterns.md`
```

---

## 応答の終わり方チェックリスト

詳細は `.claude/rules/next-step-guidance.md` の「応答の終わり方チェックリスト」を参照。
| Owner の作業が必要 | `📌 ユーザーのタスク完了が必要です` + 手順 + サポート案内 |
| 待機が必要 | `📌 次はこちら: ○分後に /org-tick` + 理由 |

**「どうしますか？」「いかがですか？」で終わることは禁止。**

---

## 具体例

### 例1: 実装完了後

**❌ NG:**
```
実装が完了しました。次はどうしますか？
- テストを書く
- レビューを依頼
- デプロイする
```

**✅ OK:**
```
✅ 実装完了: ユーザー認証機能

📌 次はこちら: /org-tick
   以下を自動実行します:
   1. ユニットテスト作成（カバレッジ80%以上）
   2. セキュリティレビュー（認証機能のため必須）
   3. 問題なければステージングにデプロイ
```

### 例2: ライブラリ選択

**❌ NG:**
```
日付処理のライブラリを選びます。どちらがいいですか？
- date-fns
- moment.js
```

**✅ OK:**
```
📊 日付処理のライブラリを選定

date-fns を採用します。

理由:
- 軽量（moment.js の 1/10 のサイズ）
- Tree-shaking 対応
- イミュータブル

DECISIONS.md に記録し、実装を進めます。

📌 次はこちら: /org-tick
```

### 例3: 本当に判断が必要な場合

**✅ OK:**
```
📌 判断をお願いします:

認証方式として2つの選択肢があります。どちらも技術的に問題なく実装可能です。

[A] JWT（推奨）
    → メリット: ステートレス、スケーラブル、モバイルアプリとの連携が容易
    → デメリット: セッション無効化が複雑
    → 選んだ場合: 認証実装 → セキュリティレビュー → デプロイ

[B] Session（Cookie）
    → メリット: セッション管理が簡単、標準的
    → デメリット: サーバー側で状態管理が必要、スケールしづらい
    → 選んだ場合: 認証実装 → Redis セットアップ → デプロイ

推奨は [A] JWT です。理由: 将来的なモバイルアプリ対応を見据えて。

どちらにしますか？
```

---

## 参考資料

- [.claude/rules/owner-task-minimization.md](owner-task-minimization.md) - Owner タスク最小化ルール
- [.claude/rules/literacy-adaptation.md](literacy-adaptation.md) - リテラシー適応ルール
- [CLAUDE.md](../../CLAUDE.md) - 次のステップ案内
