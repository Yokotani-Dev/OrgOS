# プロジェクトフロールール

> OrgOS フローの優先、スコープ制限、タスク規模判定

---

## 最優先ルール：OrgOS フロー優先

**新規セッションでも、スラッシュコマンド以外の依頼でも、必ず OrgOS フローで処理する。**

### セッション開始時の行動

1. **まず `.ai/TASKS.yaml` を確認する**
   - 進行中のプロジェクトがあるか？
   - 現在のフェーズは？
   - 未完了タスクは？

2. **依頼を OrgOS タスクとして認識する**
   - Claude Code のネイティブ Plan モード（EnterPlanMode）は**使用しない**
   - 代わりに `.ai/TASKS.yaml` に追加して管理する

3. **既存プロジェクトがある場合**
   - 依頼が既存タスクに関連するか判断
   - 関連あり → 該当タスクの一部として処理
   - 関連なし → 新規タスクとして追加

### EnterPlanMode を使わない理由

| Claude Code Plan モード | OrgOS フロー |
|------------------------|--------------|
| セッション内で完結 | 永続化（TASKS.yaml） |
| 履歴が残らない | DECISIONS.md に記録 |
| 他セッションと連携不可 | どのセッションからも参照可能 |

### 例外

以下の場合のみ OrgOS フロー外で対応してよい：

- OrgOS 自体についての質問（「OrgOS って何？」など）
- 単発の情報提供（「TypeScript の型の書き方教えて」など）
- プロジェクトと無関係な雑談

---

## プロジェクトスコープ制限

**このリポジトリが OrgOS 開発用の場合、OrgOS と無関係な依頼は受け付けない。**

### スコープ確認

依頼を受けたら、まず `CONTROL.yaml` の `project_scope` を確認:

```yaml
project_scope: "OrgOS development only"  # OrgOS 開発ディレクトリの場合
```

### スコープ内の判定基準

| 依頼 | 判定 |
|------|------|
| OrgOS の機能追加・修正 | ✅ スコープ内 |
| OrgOS のドキュメント更新 | ✅ スコープ内 |
| OrgOS の改善提案（OIP） | ✅ スコープ内 |
| OrgOS を使った別プロジェクト開発 | ❌ スコープ外 |
| Azure Function など別システムの診断 | ❌ スコープ外 |
| 一般的なプログラミング質問 | 🟡 単発ならOK |

### スコープ外の依頼を受けた場合

**必ず Owner に確認する:**

```
⚠️ スコープ外の依頼を検出しました

依頼内容: 「[依頼内容]」
このリポジトリのスコープ: 「OrgOS development only」

以下のいずれかを選んでください:

[A] 別のディレクトリで作業する
    → OrgOS と無関係なプロジェクトは別ディレクトリで管理することを推奨

[B] OrgOS の改善として扱う
    → この依頼が OrgOS に関連する場合のみ（例: OrgOS の機能追加）

[C] スコープを一時的に拡張する
    → CONTROL.yaml の project_scope を更新（推奨しない）

どれにしますか？
```

**Owner 承認なしに進めてはいけない。**

---

## タスク規模の判定

### 依頼受付時の必須チェック（重要）

依頼を受けたら、**以下を必ず実行:**

```
1. ✅ プロジェクトスコープ確認
   - CONTROL.yaml の project_scope を確認
   - スコープ外なら Owner に確認（即実行禁止）

2. ✅ タスク規模を判定
   - 小: 1ファイル、5分以内、他に影響なし
   - 中: 複数ファイル、設計判断あり
   - 大: 新機能、アーキテクチャ変更

3. ✅ 中〜大タスクは必ず TASKS.yaml に追加
   ❌ 即実行してはいけない
   ✅ TASKS.yaml に追加してから実行

4. ✅ 台帳を更新
   - TASKS.yaml: タスク追加
   - DECISIONS.md: PLAN-UPDATE-XXX として記録
   - STATUS.md / DASHBOARD.md: 更新
```

### 判断基準

| 規模 | 基準 | 対応 |
|------|------|------|
| 小 | 1ファイル以内、他タスクに影響なし | 即実行 + RUN_LOG記録 |
| 中 | 複数ファイル or 設計判断あり | TASKS.yaml追加 → 次Tickで実行 |
| 大 | 新機能、アーキテクチャ変更 | PROJECT/BRIEF から計画 |

### 小タスクの処理

```
1. その場で実行
2. STATUS.md の RUN_LOG に記録
   例: "ad-hoc: src/utils.ts にログ出力追加"
3. 完了報告 + 次のステップ案内
```

### 中〜大タスクの処理

```
1. 「これは設計変更を伴うので、計画に組み込みます」と説明
2. TASKS.yaml に追加
3. DECISIONS.md に PLAN-UPDATE-XXX として記録
4. /org-tick で実行を案内
```

### 例

```
User: 「このファイルにログ出力追加して」

Manager:
  → 小タスクと判断、即実行
  → STATUS.md に記録: "ad-hoc: src/utils.ts にログ出力追加"
  → 完了報告 + 次のステップ案内
```

```
User: 「認証機能をJWTに変更して」

Manager:
  → 大タスクと判断
  → 「これは設計変更を伴うので、計画に組み込みます」と説明
  → TASKS.yaml に追加、または /org-brief から開始を案内
```

---

## スラッシュコマンド以外の依頼への対応

### 原則

**個別のプロンプトも OrgOS の制御下に取り込む。**

ユーザーがスラッシュコマンドを使わずに依頼してきた場合：

1. **スコープ確認**
   - CONTROL.yaml の `project_scope` を確認
   - スコープ外なら Owner に確認

2. **タスクとして認識する**
   - 「これは何をする依頼か」を明確にする

3. **規模に応じて対応を選ぶ**
   - **小さいタスク** → その場で実行し、RUN_LOGに記録
   - **中〜大のタスク** → TASKS.yaml に追加して計画に組み込む

4. **必ず記録を残す**
   - 小さいタスクでも `STATUS.md` の RUN_LOG に記録
   - これにより、何が行われたか追跡可能になる

5. **完了後は OrgOS フローに戻る**
   - 次に何をすべきか案内する

---

## 参考資料

- [CLAUDE.md](../../CLAUDE.md)
- [.ai/CONTROL.yaml](../../.ai/CONTROL.yaml)
- [.ai/TASKS.yaml](../../.ai/TASKS.yaml)
