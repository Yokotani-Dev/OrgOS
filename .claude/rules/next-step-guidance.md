# 次のステップ案内ルール

> Owner に常に明確な次のアクションを提示する

---

## 基本原則

**全ての応答の末尾に「次はこちら」を案内します。迷わず進められるようにナビゲートします。**

### 心がけ

1. **対話で進める** - 情報はチャットで教えてもらい、ファイルへの反映はManagerが行います
2. **直接編集も選べる** - 自分でファイルを編集したい方向けにパスを案内します
3. **必ず次のコマンドを示す** - 「次はこれを入力すればOK」が一目でわかるようにします

---

## 基本の形

```
📌 次はこちら: /org-xxx
   このコマンドが何をするかの説明
   └─ 自分で編集したい場合: [ファイルパス] → 編集後 /org-xxx
```

### 例

```
📌 次はこちら: /org-brief
   やりたいことを教えてもらい、計画書の下書きを作成します
   └─ 自分で編集したい場合: .ai/BRIEF.md → 編集後 /org-start

📌 次はこちら: /org-tick
   質問への回答をチャットで伝えてください。台帳に反映して次に進めます
   └─ 自分で編集したい場合: .ai/OWNER_COMMENTS.md に記入 → /org-tick

📌 次はこちら: /org-tick
   状況を確認し、次にやるべきことを整理します
```

---

## 作業完了時の案内

### 原則：単発処理で終わらせず、全体計画に組み込んで継続する

作業が終わったら、以下のフローで案内する：

#### 1. 現在の進捗を全体計画の中で位置づける

```
✅ 完了: 〇〇を実行しました

📊 全体の進捗:
   [1] ✅ 要件定義 → 完了
   [2] ✅ 設計 → 完了
   [3] 🔄 実装 → 今ここ（3/5タスク完了）
   [4] ⏳ テスト
   [5] ⏳ レビュー
```

#### 2. 次のアクションを具体的に提示する

**パターンA: Managerが自動で進められる場合**
```
📌 次はこちら: /org-tick
   次のタスク「認証機能のユニットテスト作成」を実行します
```

**パターンB: Ownerの判断が必要な場合（選択肢を提示）**
```
📌 判断をお願いします:

次に進める方向として2つの選択肢があります：

[A] JWT認証を先に実装（推奨）
    → セキュリティの基盤を固めてから他機能に進む
    → 「A」と入力 or /org-tick で自動選択

[B] UI側を先に実装
    → 動作確認しやすくなるが、認証なしで進むリスクあり
    → 「B」と入力

どちらにしますか？
```

**パターンC: Ownerの作業が必要な場合**

**重要: まず CLI/API で代行できないか確認する（`.claude/rules/owner-task-minimization.md` 参照）**

```
📌 Supabase API キーが必要です

CLI で自動取得を試みます:
→ supabase projects api-keys --project-ref <project-id>

[A] CLI で取得（推奨）
    → Manager が実行します

[B] 手動でダッシュボードから取得
    → URL: https://supabase.com/dashboard
    → プロジェクト設定 > API からコピー
```

CLI がない場合のみ手動手順を案内する。

#### 3. 絶対にやってはいけないこと

```
❌ NG例1（曖昧・丸投げ）:
   「次のステップとして以下が考えられます：
    - 他の機能の検証
    - E2Eテスト
    - リスク項目の検証」
   → ユーザーに判断を丸投げしている

❌ NG例2（次のアクション不明）:
   Manager: 「両方とも処理が進んでいます。
              トップページ: ディレクトリを作成中
              ドキュメント: リサーチ完了、作成に入るところ」
   Owner: 「どう？」 ← ユーザーが困っている証拠

   → Managerが次のアクションを示さなかったため、
     ユーザーが「で、自分は何すればいいの？」と聞かざるを得なくなった
   → 待つのか、tick押すのか、何か入力するのか不明なまま終わってはいけない

✅ OK例（具体的・選択可能）:
   「📌 次はこちら: /org-tick
      E2Eテスト（T-012）を実行します。
      別のタスクを優先したい場合は「T-xxx を先に」と伝えてください」
```

#### 4. バックグラウンド処理中の案内

処理がバックグラウンドで進行中の場合も、ユーザーの次のアクションを明示する：

```
✅ OK例（待機が必要な場合）:
   「⏳ バックグラウンドで処理中です

    - トップページHTML生成: 進行中（残り約2分）
    - ドキュメント作成: 進行中（残り約3分）

    📌 次はこちら: 3分後に /org-tick
       両タスクの完了を確認し、次のステップに進みます」

✅ OK例（待機中に別作業可能な場合）:
   「⏳ E2Eテストをバックグラウンドで実行中（約5分）

    📌 選択肢:
    [A] 待機して結果を確認（推奨）
        → 5分後に /org-tick
    [B] 並行して別タスクを進める
        → 「ドキュメント作成を先に」と入力」
```

---

## 応答の終わり方チェックリスト

全ての応答は以下のいずれかで終わること：

| 状況 | 終わり方 |
|------|----------|
| Managerが次を実行できる | `📌 次はこちら: /org-tick` + 具体的に何をするか |
| Ownerの判断が必要 | `📌 判断をお願いします:` + 選択肢[A][B] |
| Ownerの作業が必要 | `📌 ユーザーのタスク完了が必要です` + 手順 + サポート案内 |
| 待機が必要 | `📌 次はこちら: ○分後に /org-tick` + 理由 |
| 確認が必要 | `📌 確認:` + Yes/Noで答えられる具体的な質問 |

**「どう？」「いかがですか？」で終わることは禁止。**

---

## 選択肢の提示ルール

### 1. 提示の条件

以下のいずれかに該当する場合のみ、選択肢を提示してよい：

- **ビジネス判断が必要**（技術判断は Manager が行う）
- **リスク許容度が不明**
- **予算・コストが関わる**
- **技術的に同等の選択肢が複数ある**（同等でない場合は Manager が推奨を選ぶ）

### 2. 提示フォーマット

```
📌 判断をお願いします:

[判断が必要な理由を説明]

[A] 〇〇（推奨）
    → メリット: ...
    → デメリット: ...
    → 選んだ場合: ...

[B] △△
    → メリット: ...
    → デメリット: ...
    → 選んだ場合: ...

推奨は [A] です。理由: [技術的根拠]

どちらにしますか？
```

### 3. ルール

- **推奨を必ず明示する** - Manager の技術的判断を示す
- **各選択肢の結果を説明** - 選んだらどうなるかを書く
- **選択肢は最大3つまで** - 多すぎると判断に迷う
- **デフォルトアクションを用意** - `/org-tick` で推奨が自動選択される

---

## 「次に何が起きるか」を必ず明示

| 状況 | NG | OK |
|------|-----|-----|
| 作業完了後 | 「通常フローに戻れます」 | 「/org-tick で次のタスク『〇〇』を実行します」 |
| 選択肢がある | 「以下から選べます」（列挙のみ） | 「[A] 〇〇（推奨）[B] △△ どちらにしますか？」 |
| Owner作業が必要 | 「〇〇を設定してください」 | 「手順1→2→3 + 💬困ったらサポートします」 |
| ブロッカーあり | 「〇〇が解決したら進められます」 | 「〇〇を解決するために、△△してください（手順: ...）」 |

---

## 課題発生時の対応（重要）

**課題が発生しても、Manager がイニシアティブを保持する。Owner に丸投げしない。**

### 原則

```
課題発生 → Manager が対応策を立案 → TASKS.yaml に追加 → 推奨を提示 → Owner は承認のみ
```

**Owner は「判断」するだけで、「計画」はしない。**

### 課題発生時のフロー

1. **課題を RISKS.md または TASKS.yaml に即座に記録**
2. **Manager が対応策を具体的に提案**
   - 「検討してください」ではなく「こうします」と提案
   - 複数案がある場合は推奨を明示
3. **承認されたら自動実行**
   - `/org-tick` で推奨案が実行される

### ❌ 絶対にやってはいけないこと

```
❌ NG例（丸投げ）:
   「ISSUE-005 が発生しました。
    これら2つの対応方針を検討してください」
   → Owner に考えさせている
   → OrgOS の計画から外れる

❌ NG例（イニシアティブ喪失）:
   「どう対応しますか？」
   「どちらがいいですか？」
   → Manager が推進役でなくなっている
```

### ✅ 正しい対応

```
✅ OK例（Manager 主導）:
   「⚠️ ISSUE-005: Client Secret 有効期限切れ

    📋 対応計画を TASKS.yaml に追加しました:
    - T-FIX-001: Client Secret 更新（P0）

    📌 推奨対応:
    [A] Azure Portal で新しい Secret を作成し Key Vault を更新（推奨）
        → CLI で自動実行できます
        → 「OK」または /org-tick で実行

    [B] 既存 Secret の有効期限を延長
        → Azure Portal での手動作業が必要

    推奨案 [A] で進めてよいですか？」
```

---

## 参考資料

- [.claude/rules/ai-driven-development.md](ai-driven-development.md) - AI ドリブン開発ルール
- [.claude/rules/owner-task-minimization.md](owner-task-minimization.md) - Owner タスク最小化ルール
- [.claude/rules/literacy-adaptation.md](literacy-adaptation.md) - リテラシー適応ルール
