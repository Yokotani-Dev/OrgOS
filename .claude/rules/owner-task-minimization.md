# Owner タスク最小化ルール

> ユーザーに作業を依頼する前に、Manager が代行できないか必ず確認する

---

## 原則

**「ユーザーにしかできないこと」だけをユーザーに依頼する**

CLI、API、スクリプトで自動化できる作業を手動でやらせない。

---

## 依頼前チェックフロー

ユーザーに作業を依頼しようとしたとき、以下の順で確認する：

```
1. CLI で実行可能か？
   → 可能なら Manager が実行

2. API で実行可能か？
   → 可能なら Manager がスクリプトを書いて実行

3. ユーザーが既に持っている情報で代用できるか？
   → 環境変数、設定ファイル、既存の認証情報など

4. 上記すべて不可能な場合のみ、ユーザーに依頼
```

---

## 具体例

### ❌ 避けるべきパターン

```
📌 ユーザーのタスク完了が必要です

1. Supabase ダッシュボードにログイン
2. プロジェクト設定 > API を開く
3. `anon` キーをコピー
4. このチャットに貼り付けてください
```

**問題**: `supabase` CLI があれば自動取得可能

### ✅ 正しいパターン

```
Supabase CLI でAPIキーを取得します。

実行コマンド:
supabase projects api-keys --project-ref <project-id>

⚠️ CLI が未インストールの場合のみ、ダッシュボードから取得してください。
```

---

## よくあるサービスと CLI/API の対応表

| サービス | CLI | 自動化可能な操作 |
|----------|-----|------------------|
| **Supabase** | `supabase` | プロジェクト作成、API キー取得、マイグレーション |
| **Vercel** | `vercel` | デプロイ、環境変数設定、ドメイン設定 |
| **Netlify** | `netlify` | デプロイ、環境変数設定 |
| **Firebase** | `firebase` | プロジェクト設定、デプロイ、認証設定 |
| **AWS** | `aws` | ほぼ全操作 |
| **GCP** | `gcloud` | ほぼ全操作 |
| **GitHub** | `gh` | リポジトリ作成、Issue/PR 操作、Secrets 設定 |
| **npm** | `npm` | パッケージ公開、トークン管理 |
| **Docker Hub** | `docker` | イメージ push/pull |
| **Stripe** | `stripe` | テストデータ作成、Webhook 設定 |
| **Cloudflare** | `wrangler` | Workers デプロイ、DNS 設定 |
| **PlanetScale** | `pscale` | ブランチ作成、スキーマ変更 |
| **Railway** | `railway` | デプロイ、環境変数設定 |
| **Fly.io** | `flyctl` | デプロイ、スケーリング |

---

## ユーザーにしかできないこと（依頼してよい）

以下は CLI/API で代行できないため、ユーザーへの依頼が適切：

### 1. 認証・アカウント関連

- 初回ログイン（`supabase login` など）
- 二要素認証の承認
- 新規アカウント作成
- 支払い情報の入力

### 2. ビジネス判断

- プランの選択（無料 / 有料）
- 本番環境への適用可否
- 外部サービス連携の承認
- 削除・破壊的操作の最終確認

### 3. 物理的・環境的制約

- ローカルにないツールのインストール（ただし手順は Manager が提示）
- ネットワーク制限があるリソースへのアクセス
- 手元のファイルのアップロード

### 4. 機密情報の取り扱い

- パスワードの入力
- クレジットカード情報
- 個人情報の入力

---

## 依頼時のフォーマット

ユーザーに依頼する場合も、最小限の作業だけを依頼する：

### Before（悪い例）

```
📌 ユーザーのタスク完了が必要です

1. GitHub にログイン
2. Settings > Developer settings > Personal access tokens に移動
3. "Generate new token" をクリック
4. スコープを選択（repo, workflow）
5. トークンを生成してコピー
6. このチャットに貼り付けてください
```

### After（良い例）

```
GitHub のトークンが必要です。

📌 Manager で実行可能か確認中...
   → `gh auth token` で既存トークンを確認できます
   → 実行してよいですか？ [Y/n]

※ 新規作成が必要な場合のみ:
   gh auth login --scopes repo,workflow
   ↑ このコマンドを実行すると、ブラウザで認証後に自動設定されます
```

---

## チェックリスト（依頼前に確認）

- [ ] CLI ツールで同じことができないか確認した
- [ ] API で自動化できないか確認した
- [ ] 既存の環境変数や設定ファイルに情報がないか確認した
- [ ] 本当にユーザーの手動操作が必要か確認した
- [ ] 必要な場合も、最小限の手順に絞った

---

## 実装ガイダンス

Manager は以下の手順で対応する：

1. **まず CLI の存在を確認**
   ```bash
   which supabase vercel netlify gh aws gcloud firebase
   ```

2. **インストールされていれば CLI で実行**
   ```bash
   supabase projects api-keys --project-ref xxx
   ```

3. **インストールされていなければ、インストールを提案**
   ```
   Supabase CLI をインストールすると、この操作を自動化できます。

   インストール: brew install supabase/tap/supabase

   [A] インストールして自動実行（推奨）
   [B] 手動でダッシュボードから取得
   ```

4. **ユーザーが手動を選んだ場合のみ、手順を案内**

---

## 参考資料

- 各サービスの CLI ドキュメント
- `.claude/rules/agent-coordination.md` - エージェント協調パターン
